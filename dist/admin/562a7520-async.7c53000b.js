(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_unfazed-admin"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_unfazed-admin"]||[]).push([["562a7520"],{"15412d9c":function(e,t,a){"use strict";a.d(t,"__esModule",{value:!0}),a.d(t,"default",{enumerable:!0,get:function(){return g;}});var o=a("777fffbe"),l=a("c7b9d8d1"),r=a("114dd8f1"),n=o._(a("04f5cc20")),i=o._(a("2b507379")),s=a("090daeff"),d=a("55c7d513"),c=a("cf01380e"),u=a("e55ae3cb"),f=o._(a("16b09a45")),g=()=>{let{message:e}=n.default.useApp(),{setInitialState:t}=(0,r.useModel)("@@initialState"),a=async(e,a)=>{if(e){var o,l,r,n,i,s;let g={name:(null===(o=e.extra)||void 0===o?void 0:o.nickname)||(null===(l=e.extra)||void 0===l?void 0:l.username)||e.account,avatar:null===(r=e.extra)||void 0===r?void 0:r.avatar,userid:e.account,email:e.email,account:e.account,roles:e.roles,groups:e.groups,extra:{...e.extra,platform:a||"default"},access:(null===(i=e.roles)||void 0===i?void 0:null===(n=i[0])||void 0===n?void 0:n.name)||"user"},h=f.default;try{let e=await (0,c.getAdminSettings)({skipErrorHandler:!0});0===e.code&&(h={...e.data,fixSiderbar:e.data.fixSiderbar??f.default.fixSiderbar,pwa:e.data.pwa??f.default.pwa,iconfontUrl:e.data.iconfontUrl??f.default.iconfontUrl},(null===(s=e.data)||void 0===s?void 0:s.authPlugins)&&localStorage.setItem("authPlugins",JSON.stringify(e.data.authPlugins)));}catch(e){console.warn("Failed to fetch settings after login, using default settings");}let m=[],p=[];try{let e=await (0,u.getRouteAndMenuData)();m=e.routeList,p=e.menuData,console.log("OAuth\u767B\u5F55\u6210\u529F\uFF0C\u5DF2\u83B7\u53D6\u52A8\u6001\u8DEF\u7531:",m);}catch(e){console.warn("\u83B7\u53D6\u52A8\u6001\u8DEF\u7531\u5931\u8D25\uFF0C\u4F7F\u7528\u7A7A\u8DEF\u7531:",e);}localStorage.setItem("userInfo",JSON.stringify(g)),localStorage.setItem("userSettings",JSON.stringify(h)),(0,d.flushSync)(()=>{t(e=>({...e,currentUser:g,settings:h,menuData:p,routeList:m}));});}};return(0,s.useEffect)(()=>{(async()=>{console.log("\u5F00\u59CB\u5904\u7406OAuth\u56DE\u8C03...");let t=new URLSearchParams(window.location.search),o=t.get("error"),l=localStorage.getItem("oauth_platform");if(console.log("platform from localStorage:",l),console.log("URL search params:",window.location.search),o){e.error(`OAuth\u{767B}\u{5F55}\u{5931}\u{8D25}: ${o}`),localStorage.removeItem("oauth_platform"),window.location.href="/admin/user/login";return;}l||(l="oauth",console.log('No platform found in localStorage, using default "oauth" for OAuth callback testing'));try{e.loading("\u6B63\u5728\u5904\u7406OAuth\u767B\u5F55...",0);let o={};t.forEach((e,t)=>{o[t]=e;});let r=t.get("state");if(r)try{let e=JSON.parse(decodeURIComponent(r));o.state_data=e;}catch(e){o.state=r;}console.log("OAuth callback params:",{platform:l,extraData:o});let n=await (0,c.login)({account:"",password:"",platform:l,extra:o});e.destroy(),0===n.code?(e.success("OAuth\u767B\u5F55\u6210\u529F\uFF01"),await a(n.data,l),localStorage.removeItem("oauth_platform"),window.location.href="/admin/"):(e.error(n.message||"OAuth\u767B\u5F55\u5931\u8D25"),localStorage.removeItem("oauth_platform"),setTimeout(()=>{window.location.href="/admin/user/login";},2e3));}catch(t){e.destroy(),e.error("OAuth\u767B\u5F55\u5904\u7406\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),console.error("OAuth login error:",t),localStorage.removeItem("oauth_platform"),setTimeout(()=>{window.location.href="/admin/user/login";},2e3);}})();},[e,t]),(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:(0,l.jsxs)("div",{style:{background:"white",padding:"40px",borderRadius:"10px",boxShadow:"0 10px 25px rgba(0,0,0,0.1)",textAlign:"center",minWidth:"300px"},children:[(0,l.jsx)(i.default,{size:"large"}),(0,l.jsx)("div",{style:{marginTop:"20px",fontSize:"16px",color:"#666",fontWeight:500},children:"\u6B63\u5728\u5904\u7406OAuth\u767B\u5F55..."}),(0,l.jsx)("div",{style:{marginTop:"10px",fontSize:"14px",color:"#999"},children:"\u8BF7\u7A0D\u5019\uFF0C\u5373\u5C06\u8DF3\u8F6C\u5230\u4E3B\u9875"})]})});};}}]);
//# sourceMappingURL=562a7520-async.7c53000b.js.map