(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_unfazed-admin"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_unfazed-admin"]||[]).push([["05793652"],{e0ab8df4:function(e,a,t){t.d(a,"__esModule",{value:!0}),t.e(a,{default:function(){return V;}});var o=t("777fffbe"),r=t("852bbaa9"),l=t("c7b9d8d1"),s=t("9b967f19"),i=o._(s),n=t("d5a72fd6"),d=o._(n),u=t("8bfe87f0"),c=t("babe7813"),g=o._(c),f=t("918f267e"),m=o._(f),p=t("6b950e86"),h=t("aa2e4ac2"),x=o._(h),v=t("090daeff"),y=r._(v),b=t("457d5490"),j=t("59b1b814"),S=o._(j),w=["options","fieldProps","proFieldProps","valueEnum"],M=y.default.forwardRef(function(e,a){var t=e.options,o=e.fieldProps,r=e.proFieldProps,s=e.valueEnum,i=(0,m.default)(e,w);return(0,l.jsx)(S.default,(0,g.default)({ref:a,valueType:"checkbox",valueEnum:(0,p.runFunction)(s,void 0),fieldProps:(0,g.default)({options:t},o),lightProps:(0,g.default)({labelFormatter:function(){return(0,l.jsx)(S.default,(0,g.default)({ref:a,valueType:"checkbox",mode:"read",valueEnum:(0,p.runFunction)(s,void 0),filedConfig:{customLightMode:!0},fieldProps:(0,g.default)({options:t},o),proFieldProps:r},i));}},i.lightProps),proFieldProps:r},i));}),P=y.default.forwardRef(function(e,a){var t=e.fieldProps,o=e.children;return(0,l.jsx)(x.default,(0,g.default)((0,g.default)({ref:a},t),{},{children:o}));}),A=(0,b.createField)(P,{valuePropName:"checked"});A.Group=M;var _=t("16834740"),F=o._(_),k=t("114dd8f1"),L=t("03c85bee"),I=o._(L),T=t("04f5cc20"),z=o._(T),C=t("dd73e28e"),O=o._(C),R=t("fa122ab9"),E=t("55c7d513"),N=t("df895261"),U=t("cf01380e"),q=t("e55ae3cb"),H=t("16b09a45"),J=o._(H);let B=(0,R.createStyles)(({token:e})=>({action:{marginLeft:"8px",color:"rgba(0, 0, 0, 0.2)",fontSize:"24px",verticalAlign:"middle",cursor:"pointer",transition:"color 0.3s","&:hover":{color:e.colorPrimaryActive}},lang:{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:e.borderRadius,":hover":{backgroundColor:e.colorBgTextHover}},container:{display:"flex",flexDirection:"column",height:"100vh",overflow:"auto",backgroundImage:"url('https://mdn.alipayobjects.com/yuyan_qk0oxh/afts/img/V-_oS6r-i7wAAAAAAAAAAAAAFl94AQBr')",backgroundSize:"100% 100%"}})),W=({authPlugins:e})=>{let{styles:a}=B(),t=async e=>{try{var a;localStorage.setItem("oauth_platform",e);let t=await (0,U.getOAuthRedirectUrl)(e);0===t.code&&(null===(a=t.data)||void 0===a?void 0:a.redirect_url)?window.location.href=t.data.redirect_url:(console.error("Failed to get OAuth redirect URL:",t.message),localStorage.removeItem("oauth_platform"));}catch(e){console.error("OAuth redirect error:",e),localStorage.removeItem("oauth_platform");}};return e&&0!==e.length?(0,l.jsx)(l.Fragment,{children:e.map((e,a)=>(0,l.jsx)("img",{src:e.icon_url,alt:e.platform||`OAuth Platform ${a+1}`,style:{width:24,height:24,cursor:"pointer",borderRadius:"50%",marginLeft:a>0?8:0,objectFit:"contain",backgroundColor:"#fff",border:"1px solid #f0f0f0",padding:"2px",transition:"all 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.1)",e.currentTarget.style.borderColor="#1890ff";},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.borderColor="#f0f0f0";},onClick:()=>t(e.platform),title:`\u{4F7F}\u{7528} ${e.platform} \u{767B}\u{5F55}`},`oauth-${e.platform||a}`))}):null;},$=()=>{let{styles:e}=B();return(0,l.jsx)("div",{className:e.lang,"data-lang":!0,children:k.SelectLang&&(0,l.jsx)(k.SelectLang,{})});},D=({content:e})=>(0,l.jsx)(I.default,{style:{marginBottom:24},message:e,type:"error",showIcon:!0}),V=()=>{let[e,a]=(0,y.useState)({}),[t,o]=(0,y.useState)("account"),[r,s]=(0,y.useState)([]),[n,c]=(0,y.useState)(!1),{initialState:g,setInitialState:f}=(0,k.useModel)("@@initialState"),{styles:m}=B(),{message:p}=z.default.useApp(),h=(0,k.useIntl)();(0,y.useEffect)(()=>{(async()=>{try{var e;let a=localStorage.getItem("authPlugins");a&&s(JSON.parse(a));let t=await (0,U.getAdminSettings)({skipErrorHandler:!0});0===t.code&&(null===(e=t.data)||void 0===e?void 0:e.authPlugins)&&(localStorage.setItem("authPlugins",JSON.stringify(t.data.authPlugins)),s(t.data.authPlugins),c(t.data.defaultLoginType));}catch(e){console.warn("Failed to fetch auth plugins:",e);}})();},[]);let x=async(e,a)=>{if(e){var t,o,r,l,s,i;let n={name:(null===(t=e.extra)||void 0===t?void 0:t.nickname)||(null===(o=e.extra)||void 0===o?void 0:o.username)||e.account,avatar:null===(r=e.extra)||void 0===r?void 0:r.avatar,userid:e.account,email:e.email,account:e.account,roles:e.roles,groups:e.groups,extra:{...e.extra,platform:a||"default"},access:(null===(s=e.roles)||void 0===s?void 0:null===(l=s[0])||void 0===l?void 0:l.name)||"user"},d=J.default;try{let e=await (0,U.getAdminSettings)({skipErrorHandler:!0});0===e.code&&(d={...e.data,fixSiderbar:e.data.fixSiderbar??J.default.fixSiderbar,pwa:e.data.pwa??J.default.pwa,iconfontUrl:e.data.iconfontUrl??J.default.iconfontUrl},(null===(i=e.data)||void 0===i?void 0:i.authPlugins)&&localStorage.setItem("authPlugins",JSON.stringify(e.data.authPlugins)));}catch(e){console.warn("Failed to fetch settings after login, using default settings");}let u=[],c=[];try{let e=await (0,q.getRouteAndMenuData)();u=e.routeList,c=e.menuData,console.log("\u767B\u5F55\u6210\u529F\uFF0C\u5DF2\u83B7\u53D6\u52A8\u6001\u8DEF\u7531:",u);}catch(e){console.warn("\u83B7\u53D6\u52A8\u6001\u8DEF\u7531\u5931\u8D25\uFF0C\u4F7F\u7528\u7A7A\u8DEF\u7531:",e);}localStorage.setItem("userInfo",JSON.stringify(n)),localStorage.setItem("userSettings",JSON.stringify(d)),(0,E.flushSync)(()=>{f(e=>({...e,currentUser:n,settings:d,menuData:c,routeList:u}));});}},v=async e=>{try{let o=await (0,U.login)({...e,type:t});if(0===o.code||"ok"===o.status){let a=h.formatMessage({id:"pages.login.success",defaultMessage:"\u767B\u5F55\u6210\u529F\uFF01"});p.success(a),await x(o.data,e.platform||"default");let t=new URL(window.location.href).searchParams;window.location.href=t.get("redirect")||"/admin/";return;}console.log(o),a({status:"error",type:t,message:o.message||"\u767B\u5F55\u5931\u8D25"});}catch(a){let e=h.formatMessage({id:"pages.login.failure",defaultMessage:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01"});console.log(a),p.error(e);}},{status:b,type:j}=e;return(0,l.jsxs)("div",{className:m.container,children:[(0,l.jsx)(k.Helmet,{children:(0,l.jsxs)("title",{children:[h.formatMessage({id:"menu.login",defaultMessage:"\u767B\u5F55\u9875"}),J.default.title&&` - ${J.default.title}`]})}),(0,l.jsx)($,{}),(0,l.jsx)("div",{style:{flex:"1",padding:"32px 0"},children:(0,l.jsxs)(u.LoginForm,{contentStyle:{minWidth:280,maxWidth:"75vw"},logo:(0,l.jsx)("img",{alt:"logo",src:"https://unfazed-eco.github.io/images/uz-logo.png"}),title:"Unfazed Admin",subTitle:h.formatMessage({id:"pages.layouts.userLayout.title"}),initialValues:{autoLogin:!0},actions:r&&r.length>0?[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,l.jsx)(k.FormattedMessage,{id:"pages.login.loginWith",defaultMessage:"\u5176\u4ED6\u767B\u5F55\u65B9\u5F0F"},"loginWith"),(0,l.jsx)(W,{authPlugins:r},"icons")]},"oauth-actions")]:[],onFinish:async e=>{await v(e);},submitter:!!n&&void 0,children:[(0,l.jsx)(O.default,{activeKey:t,onChange:o,centered:!0,items:[{key:"account",label:h.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"\u8D26\u6237\u5BC6\u7801\u767B\u5F55"})}]}),n&&"error"===b&&"account"===j&&(0,l.jsx)(D,{content:h.formatMessage({id:"pages.login.accountLogin.errorMessage",defaultMessage:"\u8D26\u6237\u6216\u5BC6\u7801\u9519\u8BEF(admin/ant.design)"})}),n&&"account"===t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(F.default,{name:"username",fieldProps:{size:"large",prefix:(0,l.jsx)(d.default,{})},placeholder:h.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"\u7528\u6237\u540D: admin or user"}),rules:[{required:!0,message:(0,l.jsx)(k.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"\u8BF7\u8F93\u5165\u7528\u6237\u540D!"})}]}),(0,l.jsx)(F.default.Password,{name:"password",fieldProps:{size:"large",prefix:(0,l.jsx)(i.default,{})},placeholder:h.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"\u5BC6\u7801: admin"}),rules:[{required:!0,message:(0,l.jsx)(k.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"})}]})]}),n&&(0,l.jsxs)("div",{style:{marginBottom:24},children:[(0,l.jsx)(A,{noStyle:!0,name:"autoLogin",children:(0,l.jsx)(k.FormattedMessage,{id:"pages.login.rememberMe",defaultMessage:"\u81EA\u52A8\u767B\u5F55"})}),(0,l.jsx)("a",{style:{float:"right"},children:(0,l.jsx)(k.FormattedMessage,{id:"pages.login.forgotPassword",defaultMessage:"\u5FD8\u8BB0\u5BC6\u7801"})})]})]})}),(0,l.jsx)(N.Footer,{})]});};}}]);
//# sourceMappingURL=05793652-async.e4019ce6.js.map